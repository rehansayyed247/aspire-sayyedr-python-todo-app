name: CI Workflow

on: 
  push:
    branches:
      - develop
      - feature/*
      - release
      - main

jobs:
  ci-job:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        include:
          - branch: develop
            environment: dev
          - branch: release
            environment: sit
          - branch: release
            environment: uat
          - branch: main
            environment: prod
          - branch: feature
            environment: dev

    steps:
      - name: Code Checkout
        uses: actions/checkout@v4

      - name: Validate branch and environment
        run: |
          echo "Branch: $GITHUB_REF_NAME"
          echo "Matrix branch: ${{ matrix.branch }}"
          echo "Environment: ${{ matrix.environment }}"

          if [[ "${GITHUB_REF_NAME}" == "${{ matrix.branch }}" ]] || 
             ([[ "${{ matrix.branch }}" == "feature" ]] && [[ "${GITHUB_REF_NAME}" == feature/* ]]); then
            echo "✅ This combination is valid"
          else
            echo "❌ Skipping this job..."
            exit 0
          fi

      - name: Build
        run: echo "Building for ${{ matrix.environment }}"

      - name: Test
        run: echo "Testing on ${{ matrix.environment }}"

      - name: Deploy
        run: echo "Deploying to ${{ matrix.environment }}"
